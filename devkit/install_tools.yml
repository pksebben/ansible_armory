---
- name: Install Tools
  block:

    - name: Install apt packages
      become: yes
      become_method: sudo
      become_user: root
      apt:
        pkg:
          - cargo
          - ansible
          - fonts-powerline
          - ripgrep
          - vagrant
          - virtualbox
          - python3-pip
          - virtualenv
          - ansible
          - emacs
          - wireshark
          - python3.8-dev
          - build-essential
          - sqlite3
          - tmux
          - vim
          - git
          - python3
          - zsh
          - curl
          - jq
          - tree
          - clang
          - libssl-dev
          - meson
          - gnome-tweaks
          - lld
          - zip
        update_cache: yes
        state: present

    - name: Retrieve Oh My Zsh
      get_url:
         url: https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh
         dest: "/home/{{ user }}/.sources/omzsh_install.sh"
         mode: '0755'
         owner: "{{ user }}"

    - name: Run Oh My Zsh inst.sh
      command: "/home/{{ user }}/.sources/omzsh_install.sh --unattended"
      become: yes
      become_user: "{{ user }}"
      args:
        creates: "/home/{{ user }}/.oh-my-zsh"

    - name: Install Ansible
      become: yes
      become_user: "{{ user }}"
      pip:
        name: ansible

    - name: Change default shell
      become: yes
      become_method: sudo
      become_user: root
      user:
        name: "{{ user }}"
        shell: /bin/zsh

 
        
